<form id="carForm">
    <label for="brand">Velg bilmerke:</label>
    <select id="brand" name="brand">
        <option value="">Velg...</option>
    </select>

    <label for="model">Velg modell:</label>
    <select id="model" name="model">
        <option value="">Velg et bilmerke først...</option>
    </select>

    <label for="year">Velg årsmodell:</label>
    <select id="year" name="year">
        <option value="">Velg en modell først...</option>
    </select>

    <label for="email">E-postadresse:</label>
    <input type="email" id="email" name="email" placeholder="Din e-post" required>

    <button type="submit">Send inn</button>
</form>



<script>
document.addEventListener("DOMContentLoaded", function () {
    var brandModelYearMap = {}; // Stores brand -> model -> years

    // Fetch CSV file from GitHub
    fetch("https://raw.githubusercontent.com/bruktbilanalytics/used-car-form/main/brand_model_year.csv")
        .then(response => response.text())
        .then(data => {
            let rows = data.split("\n").map(row => row.trim()).filter(row => row); // Clean up data
            rows.shift(); // Remove header row

            rows.forEach(row => {
                let [brand, model, year] = row.split(",");

                if (!brandModelYearMap[brand]) {
                    brandModelYearMap[brand] = {}; // Initialize brand object
                }
                if (!brandModelYearMap[brand][model]) {
                    brandModelYearMap[brand][model] = new Set(); // Use Set to store unique years
                }
                brandModelYearMap[brand][model].add(year);
            });

            // Populate the brand dropdown dynamically
            let brandDropdown = document.getElementById("brand");
            Object.keys(brandModelYearMap).forEach(brand => {
                let option = document.createElement("option");
                option.value = brand;
                option.textContent = brand;
                brandDropdown.appendChild(option);
            });

            // Update models when a brand is selected
            brandDropdown.addEventListener("change", function () {
                let selectedBrand = brandDropdown.value;
                let modelDropdown = document.getElementById("model");
                let yearDropdown = document.getElementById("year");

                modelDropdown.innerHTML = "<option value=''>Velg...</option>"; // Reset model dropdown
                yearDropdown.innerHTML = "<option value=''>Velg en modell først...</option>"; // Reset year dropdown

                if (brandModelYearMap[selectedBrand]) {
                    Object.keys(brandModelYearMap[selectedBrand]).forEach(model => {
                        let option = document.createElement("option");
                        option.value = model;
                        option.textContent = model;
                        modelDropdown.appendChild(option);
                    });
                }
            });

            // Update years when a model is selected
            let modelDropdown = document.getElementById("model");
            modelDropdown.addEventListener("change", function () {
                let selectedBrand = brandDropdown.value;
                let selectedModel = modelDropdown.value;
                let yearDropdown = document.getElementById("year");

                yearDropdown.innerHTML = "<option value=''>Velg...</option>"; // Reset year dropdown

                if (brandModelYearMap[selectedBrand] && brandModelYearMap[selectedBrand][selectedModel]) {
                    brandModelYearMap[selectedBrand][selectedModel].forEach(year => {
                        let option = document.createElement("option");
                        option.value = year;
                        option.textContent = year;
                        yearDropdown.appendChild(option);
                    });
                }
            });
        })
        .catch(error => console.error("Error loading CSV:", error));
});
</script>


